# 開発計画: キャスト詳細ページ

## 1. 概要
- 目的: `/casts/[downtownId]` のキャストカードから遷移する詳細ページ `/cast/[id]` (仮) を実装し、プロフィール情報と予算計算機能を提供する。
- 成果物: キャスト詳細ページ、遷移導線、モックデータ/計算ロジック、ツールチップを含むUI。
- スコープ外: 実DB連携、外部APIからのリアルタイム情報取得、決済などの予約機能。

## 2. 要件整理
1. キャストカードの画像・名前クリックで詳細ページへ遷移。
2. 詳細ページは上から順に以下情報を表示: キャスト画像、キャスト名、Instagramフォロワー数、TikTokフォロワー数、総フォロワー数、所属店舗名、店舗Google Mapリンク、予算計算UI。
3. ユーザーが指定する項目: 開始時間、終了時間 (指定の時間帯リスト)、来店人数、指名キャスト数、キャストドリンク数。
4. 予算は「2時間滞在」を前提に時間帯料金を参照して算出。
5. 人数料金: 時間帯料金 × 人数。
6. 指名キャスト数: 指名キャスト数 × 指名料 × 2時間。
7. キャストドリンク: 1杯2,000円 × ドリンク数。
8. 予算合計: 人数料金 + 指名料金 + ドリンク代。
9. 予算金額にツールチップを設け、クリックで算出ロジックを説明。

## 3. 実装方針
1. ルーティング: `src/app/cast/[castId]/page.tsx` (App Router) を作成し、`CastCard` のリンクを新パスに変更。
2. データ: 既存 `mockCasts` を拡張して Instagram/TikTok フォロワー数や店舗情報、料金テーブルを持つようにする (生成スクリプトや型を更新)。
3. 予算計算: クライアントサイドでフォームを制御。入力変更時に即時計算するフック/ユーティリティを用意。
4. 時間帯料金: 各店舗に時間帯別料金表を持たせ、開始/終了時間から対象の時間帯を決定して 2時間分の料金を算出。
5. ツールチップ: Headless UI or カスタムコンポーネントで表示し、内側に計算式を記載。
6. UI: 既存のネオン風デザインに合わせ、主要情報カード + 入力フォーム + 予算結果で構成。

## 4. タスク分解
1. **データ拡張**: Cast 型と mockCasts を Instagram/TikTok/店舗地図リンク/料金表込みで再生成。
2. **リンク更新**: CastCard からの遷移パスを `/cast/[castId]` に変更。
3. **詳細ページUI**: プロフィール情報セクション、店舗情報ボックス、地図リンクボタンを実装。
4. **時間帯料金取得ロジック**: 選択した開始/終了に応じて利用する料金テーブルを決定する関数を実装。
5. **予算計算フォーム**: フォーム状態管理、バリデーション、結果表示、ドリンク/指名計算。
6. **ツールチップ**: 算出式をわかりやすく開示するコンポーネント実装。
7. **結合/テスト**: ルーティング動作、計算結果、メモリライズの確認。Lint/Type Check。

## 5. スケジュール目安
- Day 1: データモデリング、mockCasts/型更新、ルーティング設計。
- Day 2: 詳細ページレイアウトと基本情報セクション作成。
- Day 3: 予算計算フォーム & ロジック実装、ツールチップ追加。
- Day 4: UI polish、アクセシビリティ微調整、テスト。
- Day 5: ドキュメント整備、レビュー準備。

## 6. リスクと対策
- **データ複雑化**: 料金テーブル等を JSON 管理し、型定義を厳密化。
- **計算ミス**: 単体テスト or util テストを用意してロジックを検証。
- **UI 遷移**: 遷移導線の断絶防止のため、キャストカードのリンクパスと詳細ページの 404 fallback を丁寧に実装。
- **フォーム入力**: 数値入力のバリデーションを行い、多人数でも破綻しない計算処理を検証。

## 7. 成果物チェックリスト
- [ ] `/cast/[id]` でキャスト詳細ページが表示される。
- [ ] キャスト画像～店舗情報までが所定の順序で表示される。
- [ ] 開始/終了時間、人数、指名キャスト数、ドリンク数を入力できる。
- [ ] 時間帯料金・人数料金・指名・ドリンク・合計が仕様どおり計算される。
- [ ] 予算の横にツールチップがあり、算出ロジックを確認できる。
- [ ] `/casts/[downtownId]` からキャスト詳細ページへ遷移できる。
- [ ] Lint/Type Check 通過、主要フローの動作確認済み。
